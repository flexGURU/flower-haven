<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 md:py-4">
    <div class="flex items-center justify-between flex-wrap">
      <!-- Logo and Brand -->
      <div class="flex items-center space-x-2">
        <a
          routerLink="/"
          class="flex items-center gap-2 text-xl sm:text-2xl font-bold"
        >
          <img
            src="assets/fh.png"
            class="w-14 h-14 sm:w-20 sm:h-20"
            alt="Flower Haven Logo"
          />
          <span>Floral Haven</span>
        </a>
      </div>

      <button
        class="block sm:hidden text-gray-700 focus:outline-none"
        (click)="isMobileMenuOpen = !isMobileMenuOpen"
      >
        <i class="pi pi-bars text-2xl"></i>
      </button>

      <div class="w-full sm:w-auto sm:flex-1 sm:max-w-md mx-auto my-3 sm:my-0">
        <div class="relative group w-full">
          <input
            type="text"
            (input)="test()"
            [(ngModel)]="searchQuery"
            pInputText
            (keyup.enter)="onSearch()"
            placeholder="Search flowers, gifts..."
            class="w-full pl-4 pr-12 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-pink-500"
          />
          <button
            (click)="onSearch()"
            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-pink-600"
          >
            üîç
          </button>
          <!-- 
          @if (products.isLoading()) {
          <div>
            <p-progress-spinner
              strokeWidth="1"
              fill="transparent"
              animationDuration=".5s"
              [style]="{ width: '50px', height: '50px' }"
            />
          </div>
          }  -->

          @if (products.data()?.length=== 0) {
          <p-message severity="info">No Products Found. </p-message>
          } @if(searchQuery()){
          <div
            class="absolute top-full left-0 mt-2 bg-white text-gray-800 shadow-lg rounded-md py-2 w-full opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10"
          >
            @for (product of products.data(); track product.id) {
            <a
              [routerLink]="['/product', product.id]"
              class="flex items-center gap-2 px-4 py-2 hover:bg-pink-50 hover:text-pink-600"
            >
              <img
                [src]="product.image_url"
                alt="{{ product.name }}"
                class="w-8 h-8 object-cover rounded-full"
              />
              <span>{{ product.name }}</span>
            </a>
            }
          </div>
          }
        </div>
      </div>

      <!-- Icons (right) -->
      <div class="flex items-center space-x-3 mt-3 sm:mt-0">
        <div class="relative inline-block">
          <button
            pButton
            type="button"
            icon="pi pi-shopping-cart"
            class="p-button-text p-button-rounded"
            routerLink="/cart"
          >
            Cart
          </button>

          @if (cartItemCount > 0) {
          <p-badge
            [value]="cartItemCount.toString()"
            severity="danger"
            class="absolute -top-2 -right-1 z-10"
          ></p-badge>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Nav Section -->
  <nav class="bg-pink-600 text-white">
    <div class="container mx-auto px-4">
      <div
        class="flex flex-col sm:flex-row sm:items-center sm:space-x-8 py-3"
        [ngClass]="{'hidden': !isMobileMenuOpen, 'flex': isMobileMenuOpen, 'sm:flex': true}"
      >
        <a
          routerLink="/products"
          class="hover:text-pink-200 transition-colors"
          routerLinkActive="text-pink-200"
          >All Products</a
        >

        <div class="relative group">
          <button
            class="hover:text-pink-200 transition-colors flex items-center"
          >
            Categories
            <i class="pi pi-chevron-down ml-1"></i>
          </button>
          <div
            class="absolute top-full left-0 bg-white text-gray-800 shadow-lg rounded-md py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10"
          >
            <a
              *ngFor="let category of categories"
              [routerLink]="['/category', category.id]"
              class="block px-4 py-2 hover:bg-pink-50 hover:text-pink-600"
            >
              {{ category.name }}
            </a>
          </div>
        </div>

        <a
          routerLink="/about"
          class="hover:text-pink-200 transition-colors"
          routerLinkActive="text-pink-200"
          >About</a
        >
        <a
          routerLink="/contact"
          class="hover:text-pink-200 transition-colors"
          routerLinkActive="text-pink-200"
          >Contact</a
        >
      </div>
    </div>
  </nav>
</header>
