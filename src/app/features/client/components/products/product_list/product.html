<div class="py-8">
  <div class="container mx-auto px-4">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Filters Sidebar -->
      <div class="lg:w-1/4 mt-16">
        <div class="bg-white p-6 rounded-lg shadow-md sticky top-24">
          <h3 class="text-lg font-semibold mb-4">Filters</h3>

          <!-- Price Range -->
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Price Range</label>
            <p-slider
              class="cursor-pointer"
              [(ngModel)]="priceRange"
              [range]="true"
              [min]="initialPriceFrom()"
              [max]="initialPriceTo()"
              (onChange)="applyFilters()"
            ></p-slider>
            <div class="flex justify-between text-sm text-gray-600 mt-2">
              <span>KES {{priceRange()[0]}}</span>
              <span>KES {{priceRange()[1]}}</span>
            </div>
          </div>

          <!-- Categories -->
          <div class="mb-6">
            <label class="block text-sm font-medium mb-2">Categories</label>
            <div class="space-y-2">
              <div
                *ngFor="let category of categories"
                class="flex items-center"
              >
                <p-checkbox
                  [(ngModel)]="selectedCategories"
                  [value]="category.id"
                  (onChange)="applyFilters()"
                ></p-checkbox>
                <label class="ml-2 text-sm">{{category.name}}</label>
              </div>
            </div>
          </div>

          <!-- Availability -->

          <button
            pButton
            type="button"
            label="Clear Filters"
            class="p-button-outlined w-full"
            (click)="clearFilters()"
          ></button>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="lg:w-3/4">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
          <div>
            <h1 class="text-2xl font-bold text-gray-800">{{pageTitle}}</h1>
          </div>
        </div>

        @if (productQueryData.isLoading()) {
        <div class="flex justify-center items-center py-8">
          <div class="card flex justify-center">
            <p-progress-spinner strokeWidth="6" fill="transparent" />
          </div>
        </div>
        } @if(productQueryData.isError()){
        <p-message severity="error">Failed to Fetch Products</p-message>

        } @if(productQueryData.data()){
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          @for (product of productQueryData.data(); track $index) {
          <div class="product-card">
            <p-card
              class="h-full hover:shadow-lg transition-shadow duration-300"
            >
              <ng-template pTemplate="header">
                <div class="relative w-full h-64">
                  <img
                    [src]="product.image_url"
                    [alt]="product.name"
                    class="w-full h-full object-cover cursor-pointer rounded-t-lg"
                    [routerLink]="['/product', product.id]"
                  />

                  <div class="absolute top-2 right-2">
                    <button
                      pButton
                      type="button"
                      icon="pi pi-heart"
                      class="p-button-rounded p-button-text p-button-sm bg-white shadow-md"
                    ></button>
                  </div>
                  <div
                    *ngIf="!product.stock_quantity"
                    class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"
                  >
                    <span class="text-white font-semibold">Out of Stock</span>
                  </div>
                </div>
              </ng-template>

              <div class="p-4">
                <h3
                  class="font-semibold text-lg mb-2 cursor-pointer hover:text-pink-600"
                  [routerLink]="['/product', product.id]"
                >
                  {{product.name}}
                </h3>
                <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                  {{product.description}}
                </p>
                <div class="flex justify-between items-center">
                  <span class="text-2xl font-bold text-pink-600"
                    >KES {{product.price}}</span
                  >
                </div>
              </div>
            </p-card>
          </div>
          }
        </div>

        } @if (productQueryData.data()?.length === 0) {
        <p-message severity="info"
          >No Products Found.
          <button
            pButton
            type="button"
            icon="pi pi-refresh"
            label="Refresh"
            class="p-button-text p-ml-2"
            (click)="refreshProducts()"
          ></button>
        </p-message>
        }

        <p-paginator
          (onPageChange)="onPageChange($event)"
          [first]="first()"
          [rows]="15"
          [totalRecords]="total()"
          [rowsPerPageOptions]="[15,  30, 50]"
        />
      </div>
    </div>
  </div>
</div>

<p-toast />
